{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://1er-degre.fr/schemas/invoice.json",
  "title": "Invoice",
  "description": "Financial invoice document for orders and services",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique invoice identifier",
      "readOnly": true
    },
    "invoice_number": {
      "type": "string",
      "description": "Human-readable invoice number"
    },
    "order_id": {
      "type": ["string", "null"],
      "format": "uuid",
      "description": "Reference to order if invoice is for product purchase"
    },
    "workshop_id": {
      "type": ["string", "null"],
      "format": "uuid",
      "description": "Reference to workshop if invoice is for participation"
    },
    "user_id": {
      "type": "string",
      "format": "uuid",
      "description": "Reference to customer/participant"
    },
    "company_id": {
      "type": ["string", "null"],
      "format": "uuid",
      "description": "Reference to company for B2B invoices"
    },
    "issue_date": {
      "type": "string",
      "format": "date",
      "description": "Invoice issue date"
    },
    "due_date": {
      "type": "string",
      "format": "date",
      "description": "Payment due date"
    },
    "line_items": {
      "type": "array",
      "description": "Invoice line items",
      "items": {
        "type": "object",
        "properties": {
          "description": {
            "type": "string",
            "description": "Line item description"
          },
          "quantity": {
            "type": "number",
            "minimum": 0,
            "description": "Quantity"
          },
          "unit_price": {
            "type": "number",
            "minimum": 0,
            "description": "Price per unit"
          },
          "amount": {
            "type": "number",
            "minimum": 0,
            "description": "Total amount for this line"
          }
        },
        "required": ["description", "quantity", "unit_price", "amount"]
      },
      "minItems": 1
    },
    "subtotal": {
      "type": "number",
      "minimum": 0,
      "description": "Sum of all line items before tax"
    },
    "tax_rate": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Tax rate as decimal (0.20 for 20%)"
    },
    "tax_total": {
      "type": "number",
      "minimum": 0,
      "description": "Total tax amount"
    },
    "grand_total": {
      "type": "number",
      "minimum": 0,
      "description": "Final total including tax"
    },
    "status": {
      "type": "string",
      "enum": ["draft", "issued", "paid", "overdue", "cancelled", "void"],
      "description": "Invoice billing status"
    },
    "payment_date": {
      "type": ["string", "null"],
      "format": "date",
      "description": "Date payment was received"
    },
    "payment_method": {
      "type": ["string", "null"],
      "description": "Payment method used"
    },
    "notes": {
      "type": ["string", "null"],
      "description": "Additional notes or payment terms"
    },
    "pdf_url": {
      "type": ["string", "null"],
      "format": "uri",
      "description": "URL to invoice PDF",
      "readOnly": true
    },
    "tenant_id": {
      "type": "string",
      "description": "Tenant identifier for multi-tenant isolation",
      "default": "1er-Degr√©"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Invoice creation timestamp",
      "readOnly": true
    },
    "updated_at": {
      "type": "string",
      "format": "date-time",
      "description": "Last update timestamp",
      "readOnly": true
    }
  },
  "required": [
    "invoice_number",
    "user_id",
    "issue_date",
    "due_date",
    "line_items",
    "subtotal",
    "tax_rate",
    "tax_total",
    "grand_total",
    "status"
  ]
}
